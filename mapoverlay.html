<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Drop Location Map</title>
  <style>
    html, body {
      margin: 0;
      padding: 0;
      background: black;
      overflow: hidden;
    }
    #map-container {
      position: relative;
      width: 100vw;
      height: 100vh;
    }
    #map {
      width: 100%;
      height: 100%;
      object-fit: contain;
    }
    #marker {
      position: absolute;
      width: 24px;
      height: 24px;
      background-color: red;
      border-radius: 50%;
      border: 2px solid white;
      transform: translate(-50%, -50%);
      pointer-events: none;
    }
  </style>
</head>
<body>
  <div id="map-container">
    <img id="map" src="" alt="Fortnite Map">
    <div id="marker" style="display:none;"></div>
  </div>

  <script>
    const markerEl = document.getElementById("marker");
    const mapImg = document.getElementById("map");

    const poiCoordinates = {
      "Brutal Bastion": [3970, 3040],
      "Frenzy Fields": [3000, 4000],
      "Mega City": [4600, 4200],
      "Shattered Slabs": [2100, 4200],
      "Slappy Shores": [4300, 2500],
      "Steamy Springs": [3600, 4400],
      "The Citadel": [1700, 2200],
      "Lonely Labs": [4900, 1700],
      "Anvil Square": [2900, 3000],
      "Breakwater Bay": [1000, 1900],
      "Faulty Splits": [3900, 3600],
      "Kenjutsu Crossing": [4900, 4900]
    };

    async function loadMapImage() {
      const res = await fetch("https://fortnite-api.com/v1/map");
      const data = await res.json();
      const imageUrl = data.data.images.pois;
      mapImg.src = imageUrl;
    }

    async function updateMarker() {
      try {
        const res = await fetch("location.json", { cache: "no-store" });
        const data = await res.json();
        const location = data.location;

        if (location && poiCoordinates[location]) {
          const [x, y] = poiCoordinates[location];

          // Fortnite map is 5120 x 5120 coordinates, so scale to image size
          const mapWidth = mapImg.clientWidth;
          const mapHeight = mapImg.clientHeight;

          const left = (x / 5120) * mapWidth;
          const top = (y / 5120) * mapHeight;

          markerEl.style.left = `${left}px`;
          markerEl.style.top = `${top}px`;
          markerEl.style.display = "block";
        } else {
          markerEl.style.display = "none";
        }
      } catch (e) {
        console.error("Failed to update marker:", e);
      }
    }

    loadMapImage();
    setInterval(updateMarker, 2000);
  </script>
</body>
</html>
