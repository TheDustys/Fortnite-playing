<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Fortnite Drop Location</title>
  <style>
    body, html {
      margin: 0;
      padding: 0;
      overflow: hidden;
      background-color: black;
    }
    #map-container {
      position: relative;
      width: 100vw;
      height: 100vh;
    }
    #map-image {
      width: 100%;
      height: 100%;
      object-fit: contain;
    }
    #marker {
      position: absolute;
      width: 24px;
      height: 24px;
      background: red;
      border-radius: 50%;
      transform: translate(-50%, -50%);
      display: none;
      box-shadow: 0 0 12px 4px rgba(255, 0, 0, 0.8);
    }
  </style>
</head>
<body>
  <div id="map-container">
    <img id="map-image" src="" alt="Fortnite Map" />
    <div id="marker"></div>
  </div>

  <script>
    window.onload = async () => {
      try {
        const locationRes = await fetch("location.json", { cache: "no-store" });
        const { name, x, y } = await locationRes.json();

        if (!name || x === undefined || y === undefined) {
          console.warn("Incomplete location data.");
          return;
        }

        const mapRes = await fetch("https://fortnite-api.com/v1/map");
        const mapData = await mapRes.json();

        const imageUrl = mapData.data.images.blank;
        document.getElementById("map-image").src = imageUrl;

        const mapImage = document.getElementById("map-image");
        mapImage.onload = () => {
          const container = document.getElementById("map-container");
          const containerWidth = container.clientWidth;
          const containerHeight = container.clientHeight;

          const offsetX = (x + 5120) / 10240;
          const offsetY = 1 - (y + 5120) / 10240;

          const pixelX = offsetX * containerWidth;
          const pixelY = offsetY * containerHeight;

          const marker = document.getElementById("marker");
          marker.style.left = `${pixelX}px`;
          marker.style.top = `${pixelY}px`;
          marker.style.display = "block";
        };

      } catch (err) {
        console.error("Error loading map overlay:", err);
      }
    };
  </script>
</body>
</html>
