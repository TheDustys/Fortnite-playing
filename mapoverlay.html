<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>Fortnite Drop Map Overlay</title>
  <style>
    html, body {
      margin: 0;
      padding: 0;
      overflow: hidden;
      background: black;
    }
    #map-container {
      position: relative;
      width: 100vw;
      height: 100vh;
    }
    #map-image {
      width: 100%;
      height: 100%;
      object-fit: contain;
    }
    #marker {
      position: absolute;
      width: 40px;
      height: 40px;
      background: url('https://upload.wikimedia.org/wikipedia/commons/e/ec/RedDot.svg') no-repeat center center;
      background-size: contain;
      pointer-events: none;
      transform: translate(-50%, -50%);
      display: none;
    }
  </style>
</head>
<body>
  <div id="map-container">
    <img id="map-image" src="" alt="Fortnite Map" />
    <div id="marker"></div>
  </div>

  <script>
    async function loadLocationAndMap() {
      try {
        // Step 1: Get the chosen location from location.json
        const locationRes = await fetch("location.json", { cache: "no-store" });
        const { location } = await locationRes.json();

        if (!location) return;

        // Step 2: Get map data from Fortnite API
        const mapRes = await fetch("https://fortnite-api.com/v1/map");
        const mapData = await mapRes.json();

        const imageUrl = mapData.data.images.blank;
        document.getElementById("map-image").src = imageUrl;

        const poi = mapData.data.pois.find(p => p.name.toLowerCase() === location.toLowerCase());

        if (!poi) {
          console.warn("POI not found:", location);
          return;
        }

        // Step 3: Convert Fortnite coordinates to screen position
        const { x, y } = poi.location;
        const marker = document.getElementById("marker");

        // Wait until the image is loaded to get dimensions
        const mapImage = document.getElementById("map-image");
        mapImage.onload = () => {
          const imgWidth = mapImage.naturalWidth;
          const imgHeight = mapImage.naturalHeight;

          // Fortnite coords are roughly in a -5120 to +5120 space
          const mapWidthUnits = 10240;
          const mapHeightUnits = 10240;

          const offsetX = (x + 5120) / mapWidthUnits;
          const offsetY = 1 - (y + 5120) / mapHeightUnits;

          const container = document.getElementById("map-container");
          const containerWidth = container.clientWidth;
          const containerHeight = container.clientHeight;

          const pixelX = offsetX * containerWidth;
          const pixelY = offsetY * containerHeight;

          marker.style.left = `${pixelX}px`;
          marker.style.top = `${pixelY}px`;
          marker.style.display = "block";
        };

      } catch (err) {
        console.error("Error loading map overlay:", err);
      }
    }

    loadLocationAndMap();
  </script>
</body>
</html>
